# 任务复杂度分级标准（v2.1.0）

**生效时间：** 2026-02-17 21:35  
**版本：** v2.1.0  
**状态：** ✅ 立即生效

---

## 📊 任务复杂度分级标准

### S 级（简单任务）⚡
**定义：** 单文件修改、文档更新、配置调整、简单 bug 修复

**特征：**
- ✅ 只影响 1 个文件
- ✅ 代码变更 < 50 行
- ✅ 无需架构设计
- ✅ 无需外部依赖调查
- ✅ 测试简单或无需测试

**流程：** 快速通道（5 分钟完成）
```
1. 理解任务（1 分钟）
2. 直接实施（3 分钟）
3. 简单测试/验证（1 分钟）
4. 更新文档（可选，24 小时内完成）
```

**示例：**
- 修复拼写错误
- 更新配置文件
- 添加简单日志
- 修改注释
- 调整参数

**豁免：**
- ❌ 跳过四轮专家会议
- ❌ 跳过可行性调查
- ❌ 跳过风险评估
- ✅ 仍需遵守 P0 规则（质量第一、代码审查、测试标准）

---

### M 级（中等任务）🔧
**定义：** 新功能开发、模块重构、工具集成、性能优化

**特征：**
- ✅ 影响 2-5 个文件
- ✅ 代码变更 50-500 行
- ✅ 需要简单架构设计
- ✅ 可能需要外部依赖
- ✅ 需要测试（覆盖率 ≥ 80%）

**流程：** 简化版两轮会议（30 分钟完成）
```
第一轮：可行性与实施（15 分钟）
- 技术方案分析
- 外部依赖调查
- 实施步骤规划

第二轮：安全与测试（15 分钟）
- 风险评估（≥2 个失败场景）
- 测试策略
- 回滚方案
```

**示例：**
- 开发新工具（如 file_read）
- 重构现有模块
- 集成第三方 API
- 性能优化（提升 20%+）
- 添加新功能模块

**要求：**
- ✅ 必须执行简化版两轮会议
- ✅ 必须进行可行性调查
- ✅ 必须评估风险（≥2 个失败场景）
- ✅ 必须编写测试（覆盖率 ≥ 80%）
- ✅ 必须更新文档

---

### L 级（复杂任务）🏗️
**定义：** 系统架构变更、核心模块开发、多模块重构、平台级功能

**特征：**
- ✅ 影响 >5 个文件
- ✅ 代码变更 >500 行
- ✅ 需要完整架构设计
- ✅ 依赖多个外部系统
- ✅ 需要完整测试和文档
- ✅ 可能影响现有功能

**流程：** 完整四轮会议（90 分钟完成）
```
第一轮：技术方案分析（≤9 分钟）
- 技术选型
- 架构设计
- 潜在问题和瓶颈
- 优化方案

第二轮：安全与崩溃防护（≤9 分钟）
- 分析所有崩溃点
- 设计多层防护机制
- 制定容错和恢复策略
- 承诺：永不崩溃、永不阻塞

第三轮：收益与最优化分析（≤9 分钟）
- 量化项目收益
- 制定分阶段优化路径
- 设定可衡量的终极指标
- 注意：不评估时间成本

第四轮：开发规范制定（≤9 分钟）
- Git 工作流规范
- 代码质量标准
- 测试覆盖要求
- 安全合规规范
```

**示例：**
- 开发 JARVIS Core 系统
- 重构整个工具引擎
- 开发多用户支持
- 开发知识图谱系统
- 平台迁移（如 Python → TypeScript）

**要求：**
- ✅ 必须执行完整四轮专家会议
- ✅ 必须进行详细可行性调查
- ✅ 必须评估风险（≥3 个失败场景 + 备选方案）
- ✅ 必须 MVP 优先（先验证核心逻辑）
- ✅ 必须编写完整测试（覆盖率 ≥ 80%）
- ✅ 必须编写完整文档
- ✅ 必须持续更新记忆（每日记录）

---

## 🎯 任务复杂度判断流程

### 自动判断（AI 辅助）
```python
def judge_complexity(task_description):
    """
    AI 辅助判断任务复杂度
    返回：'S' | 'M' | 'L'
    """
    # 关键词匹配
    if any(kw in task_description for kw in ['拼写', '配置', '注释', '参数']):
        return 'S'
    
    if any(kw in task_description for kw in ['架构', '重构', '平台', '核心', '系统']):
        return 'L'
    
    # 默认 M 级
    return 'M'
```

### 人工判断检查清单
```markdown
- [ ] 影响几个文件？
  - 1 个 → S
  - 2-5 个 → M
  - >5 个 → L

- [ ] 代码变更多少行？
  - <50 行 → S
  - 50-500 行 → M
  - >500 行 → L

- [ ] 是否需要架构设计？
  - 否 → S
  - 简单设计 → M
  - 完整设计 → L

- [ ] 是否有外部依赖？
  - 无 → S
  - 1-2 个 → M
  - >2 个 → L

- [ ] 是否影响现有功能？
  - 否 → S
  - 轻微影响 → M
  - 重大影响 → L
```

### 争议处理
如果对复杂度有争议：
1. **就高不就低**：选择更高级别（安全优先）
2. **专家裁决**：召集 1-2 位专家快速讨论（≤5 分钟）
3. **记录决策**：更新到 `memory/YYYY-MM-DD.md`

---

## 📋 流程对比

| 维度 | S 级（快速通道） | M 级（标准流程） | L 级（完整流程） |
|------|----------------|----------------|----------------|
| **会议轮数** | 0 轮 | 2 轮 | 4 轮 |
| **总耗时** | 5 分钟 | 30 分钟 | 90 分钟 |
| **可行性调查** | ❌ 跳过 | ✅ 简化版 | ✅ 详细版 |
| **风险评估** | ❌ 跳过 | ✅ ≥2 个场景 | ✅ ≥3 个场景 + 备选 |
| **测试要求** | 简单验证 | 覆盖率 ≥ 80% | 覆盖率 ≥ 80% + 回归 |
| **文档要求** | 可选（24h 内） | 必须 | 必须 + 完整 |
| **代码审查** | ✅ 必须 | ✅ 必须 | ✅ 必须 + 多人 |
| **适用场景** | 简单修改 | 新功能/重构 | 架构变更/核心 |

---

## 🚨 例外机制

### 紧急修复（Hotfix）
**场景：** 生产环境严重 bug，需要立即修复

**流程：**
1. **立即修复**（无需会议）
2. **简单测试**（验证修复）
3. **快速部署**
4. **事后补文档**（24 小时内）
5. **事后复盘**（48 小时内，分析根因）

**要求：**
- ✅ 必须是真正紧急（影响核心功能）
- ✅ 必须事后补全流程
- ✅ 必须记录到 `memory/YYYY-MM-DD.md`

### 实验性代码（Experimental）
**场景：** 探索性开发、技术验证、原型设计

**流程：**
1. **标记为 `experimental/`**
2. **宽松规则**（无需完整流程）
3. **验证成功后** → 转为正式代码（补全流程）
4. **验证失败** → 删除或归档

**要求：**
- ✅ 必须在 `experimental/` 目录下
- ✅ 必须标记为“实验性”
- ✅ 不得直接用于生产

---

## 📊 统计与优化

### 任务分布目标
- **S 级：** 50-60%（快速完成，减少流程开销）
- **M 级：** 30-40%（标准流程，保证质量）
- **L 级：** 10-20%（完整流程，谨慎决策）

### 优化方向
- **目标：** 将更多 L 级任务拆解为 M 级或 S 级
- **方法：** MVP 思维、分阶段实施、模块化设计
- **收益：** 减少流程开销，加快交付速度

---

## 📝 变更记录

### v2.1.0（2026-02-17 21:35）
- ✅ 初始版本
- ✅ 定义 S/M/L 三级标准
- ✅ 定义快速通道/标准流程/完整流程
- ✅ 添加例外机制（紧急修复、实验性代码）
- ✅ 添加自动判断和人工判断指南

---

**下一步：** 更新会话启动流程，支持复杂度判断。
