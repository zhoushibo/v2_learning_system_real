import time
start = time.time()

# 读取
with open('C:/Users/10952/.openclaw/workspace/MEMORY_CLEAN.tmp', 'r', encoding='utf-8') as f:
    c = f.read()

# 新规则
new_rules = """
### 🚨 **规则 5：资源利用效率最大化（2026-02-18 11:06）**
**重要等级：** 🔴 高
**优先级：** P1
**制定人：** 博 + Claw

#### **核心：**
**所有项目开发，必须最大化利用现有资源，避免重复造轮子！**

#### **具体执行：**
- ✅ **优先复用现有组件**（MVP JARVIS、V2 学习系统、钉钉 Agent 等已完成项目）
- ✅ **优先使用 OpenClaw 工具**（web_search、web_fetch、exec 等）
- ✅ **优先使用免费资源**（NVIDIA 免费 API、开源框架）
- ✅ **优先使用已有记忆**（memory/*.md、MEMORY.md、STATE.json）
- ❌ **禁止重复造轮子**（除非现有组件有重大缺陷）

#### **专家会议必须讨论：**
第三轮（收益与最优化分析）中**必须包含**：
- "现有资源清单"
- "可复用组件清单"
- "效率提升预期（复用 vs 重写）"

---

### 🚨 **规则 6：输出格式化规范（2026-02-18 11:21）**
**重要等级：** 🔴 最高
**优先级：** P0（必须执行，违反=失败）
**制定人：** 博 + Claw（6 位专家会议）

#### **核心原则：**
**所有输出必须让用户在 3 秒内找到重点，30 秒内理解核心内容。**

#### **🔴 P0 铁律（5 条，违反=失败）：**

| 编号 | 铁律 | 量化标准 |
|------|------|----------|
| **1** | **总结先行** | **必须**在第 1-2 行出现"一句话总结" |
| **2** | **重点加粗** | **所有**数字、选项、关键结论必须加粗 |
| **3** | **强制留白** | 段落间**至少 1 行空行**，大章节间**至少 2 行** |
| **4** | **表格优先** | **超过 3 项对比必须用表格** |
| **5** | **代码独立** | **所有**命令/配置必须用 ``` 包裹 |

#### **✅ 输出前自检清单（每次必做）：**

```
□ 1. 开头是否有"一句话总结"？（是/否）
□ 2. 所有数字、选项、关键结论是否加粗？（是/否）
□ 3. 段落间是否有至少 1 行空行？（是/否）
□ 4. 超过 3 项对比是否用了表格？（是/否/不适用）
□ 5. 所有命令/配置是否用 ``` 包裹？（是/否/不适用）
```

**5 项全部为"是" → 可以输出**
**任意 1 项为"否" → 必须修正**

#### **详细文档：** `workspace/RULE_OUTPUT_FORMATTING.md`

---

"""

# 在位置 1060 插入（---和##之间）
new_content = c[:1060] + '\n' + new_rules + c[1060:]

# 写入
with open('C:/Users/10952/.openclaw/workspace/MEMORY.md', 'w', encoding='utf-8') as f:
    f.write(new_content)

elapsed = time.time() - start
print(f'✅ 步骤 3 完成：插入规则耗时 {elapsed:.2f}秒')
print(f'💾 MEMORY.md 已更新')
print(f'📄 新文件大小：{len(new_content):,} 字符')

# 验证
if '规则 5' in new_content and '规则 6' in new_content:
    print('✅ 验证成功：规则 5 和规则 6 已写入')
else:
    print('❌ 验证失败：规则未找到')
