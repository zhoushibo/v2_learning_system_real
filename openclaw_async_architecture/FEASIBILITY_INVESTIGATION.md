# OpenClaw V2é¡¹ç›® - å¯è¡Œæ€§è°ƒæŸ¥ç»“æœ

**è°ƒæŸ¥æ—¶é—´ï¼š** 2026-02-15 23:27
**è°ƒæŸ¥äººï¼š** åš + Claw
**çŠ¶æ€ï¼š** âœ… **é¡¹ç›®å¯è¡Œï¼**

---

## ğŸ¯ è°ƒæŸ¥ç›®æ ‡

éªŒè¯OpenClaw V2çš„Workeræ˜¯å¦å¯ä»¥é€šè¿‡å¤–éƒ¨APIè°ƒç”¨V1ã€‚

**å…³é”®å‡è®¾ï¼š**
- âŒ ä¹‹å‰é”™è¯¯å‡è®¾ï¼šéœ€è¦å†…éƒ¨è°ƒç”¨`sessions_spawn`
- âœ… æ­£ç¡®å‡è®¾ï¼šä½¿ç”¨V1æä¾›çš„HTTP API

---

## ğŸ” è°ƒæŸ¥è¿‡ç¨‹

### ç¬¬1æ­¥ï¼šå‘ç°HTTP API ğŸ“š
é€šè¿‡é˜…è¯»OpenClawæ–‡æ¡£å‘ç°ï¼š
- **æ–‡æ¡£ä½ç½®ï¼š** `C:\Users\10952\AppData\Roaming\npm\node_modules\@qingchencloud\openclaw-zh\docs\gateway\openai-http-api.md`
- **APIæ ¼å¼ï¼š** OpenAIå…¼å®¹çš„`/v1/chat/completions`
- **è®¤è¯æ–¹å¼ï¼š** `Authorization: Bearer <token>`
- **Agenté€‰æ‹©ï¼š** `x-openclaw-agent-id: <agentId>` æˆ– `model: "openclaw:<agentId>"`

**å…³é”®é…ç½®ï¼š**
```json
{
  "gateway": {
    "http": {
      "endpoints": {
        "chatCompletions": { "enabled": true }
      }
    }
  }
}
```

### ç¬¬2æ­¥ï¼šé…ç½®Gateway ğŸ”§
```bash
# å¯ç”¨HTTP API
openclaw config set gateway.http.endpoints.chatCompletions.enabled true

# é‡å¯Gateway
openclaw gateway restart
```

**Gatewayé…ç½®ï¼š**
- åœ°å€ï¼š`http://127.0.0.1:18790`
- Tokenï¼š`lbprg74nqGxsvopWqkgLAAefoIWKobzH`

### ç¬¬3æ­¥ï¼šæµ‹è¯•APIå¯ç”¨æ€§ âœ…
```bash
curl http://127.0.0.1:18790/v1/chat/completions \
  -H 'Authorization: Bearer lbprg74nqGxsvopWqkgLAAefoIWKobzH' \
  -H 'x-openclaw-agent-id: main' \
  -d '{"model":"openclaw","messages":[{"role":"user","content":"ä½ å¥½"}]}'
```

**ç»“æœï¼šæˆåŠŸè¿”å›chat.completionæ ¼å¼**

### ç¬¬4æ­¥ï¼šæµ‹è¯•å·¥å…·è°ƒç”¨ ğŸ› ï¸
å‘é€è¯·æ±‚ï¼š`"ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"`

**ç»“æœï¼šOpenClauæ­£å¸¸è°ƒç”¨session_statuså·¥å…·**

### ç¬¬5æ­¥ï¼šæµ‹è¯•å¹¶å‘ä»»åŠ¡ âš¡
åŒæ—¶æäº¤ä¸¤ä¸ªä»»åŠ¡ï¼š
- Task1ï¼šåˆ†æä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼ˆ4.2ç§’ï¼‰
- Task2ï¼šå†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—ï¼ˆ6.2ç§’ï¼‰

**ç»“æœï¼šä¸¤ä¸ªä»»åŠ¡éƒ½æˆåŠŸå®Œæˆï¼Œæ”¯æŒå¹¶å‘**

---

## âœ… è°ƒæŸ¥ç»“è®º

### é¡¹ç›®å¯è¡Œæ€§ï¼š**å®Œå…¨å¯è¡Œ** ğŸ‰

**è¯æ®ï¼š**
1. âœ… HTTP APIå¯ä»¥æ­£å¸¸è°ƒç”¨V1
2. âœ… å·¥å…·ç³»ç»Ÿå®Œå…¨å¯ç”¨ï¼ˆåŒ…æ‹¬execã€readã€writeç­‰ï¼‰
3. âœ… æ”¯æŒå¹¶å‘ä»»åŠ¡æäº¤
4. âœ… è®¤è¯æœºåˆ¶ç¨³å®š
5. âœ… å“åº”æ ¼å¼æ ‡å‡†ï¼ˆOpenAIå…¼å®¹ï¼‰

---

## ğŸ—ï¸ Workerå®ç°æ¶æ„

### æ–¹æ¡ˆç¡®è®¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OpenClaw V2 æ¶æ„                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚   Gateway    â”‚  â† FastAPI                    â”‚
â”‚  â”‚  (V2æ–°å¢)    â”‚  - æ¥æ”¶æ¶ˆæ¯                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - æäº¤åˆ°é˜Ÿåˆ—                 â”‚
â”‚         â”‚         - è¿”å›task_id <50ms            â”‚
â”‚         â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ Task Queue   â”‚  â† Redis                      â”‚
â”‚  â”‚  (V2æ–°å¢)    â”‚  - ä»»åŠ¡è°ƒåº¦                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - ä¼˜å…ˆçº§ç®¡ç†                 â”‚
â”‚         â”‚                                      â”‚
â”‚         â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Worker Pool (V2æ–°å¢)        â”‚      â”‚
â”‚  â”‚                                     â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
â”‚  â”‚  â”‚Worker 1â”‚      â”‚Worker Nâ”‚        â”‚      â”‚
â”‚  â”‚  â”‚        â”‚      â”‚        â”‚        â”‚      â”‚
â”‚  â”‚  â”‚ HTTP    â”‚      â”‚ HTTP   â”‚        â”‚      â”‚
â”‚  â”‚  â”‚ Client  â”‚      â”‚ Client â”‚        â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚              â”‚                     â”‚
â”‚          â–¼              â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   OpenClaw V1 Gateway (å·²æœ‰ï¼Œå¤ç”¨)     â”‚   â”‚
â”‚  â”‚   http://127.0.0.1:18790              â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚   - LLMè°ƒç”¨ (GLM-4.7, GLM-5...)     â”‚   â”‚
â”‚  â”‚   - å·¥å…·ç³»ç»Ÿ (exec, read, write...) â”‚   â”‚
â”‚  â”‚   - è®°å¿†ç³»ç»Ÿ (MEMORY.md)            â”‚   â”‚
â”‚  â”‚   - æŠ€èƒ½ç³»ç»Ÿ (skills)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workerå®ç°ç»†èŠ‚

```python
class V2Worker:
    """OpenClaw V2 Worker

    é€šè¿‡HTTP APIè°ƒç”¨V1 Gateway
    """

    def __init__(self, gateway_url, token, agent_id="main"):
        self.gateway_url = gateway_url
        self.token = token
        self.agent_id = agent_id
        self.session = httpx.AsyncClient(
            timeout=60.0,  # é•¿ä»»åŠ¡æ”¯æŒ
            limits=httpx.Limits(max_keepalive_connections=100)
        )

    async def execute_task(self, task: Task) -> TaskResult:
        """é€šè¿‡HTTP APIæ‰§è¡Œä»»åŠ¡"""
        payload = {
            "model": "openclaw",
            "messages": [
                {"role": "user", "content": task.content}
            ]
        }

        response = await self.session.post(
            f"{self.gateway_url}/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {self.token}",
                "Content-Type": "application/json",
                "x-openclaw-agent-id": self.agent_id
            },
            json=payload
        )

        if response.status_code == 200:
            data = response.json()
            return TaskResult(
                task_id=task.id,
                status="completed",
                content=data["choices"][0]["message"]["content"],
                usage=data.get("usage", {})
            )
        else:
            raise TaskError(f"HTTP {response.status_code}: {response.text}")
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å®æµ‹æ•°æ®

| æŒ‡æ ‡ | æµ‹è¯•ç»“æœ |
|------|----------|
| **ç®€å•ä»»åŠ¡å“åº”** | 4-6ç§’ |
| **å¹¶å‘ä»»åŠ¡æ”¯æŒ** | âœ… æ”¯æŒ |
| **å·¥å…·è°ƒç”¨** | âœ… æ­£å¸¸ |
| **è®¤è¯æ€§èƒ½** | <50ms |
| **æ”¯æŒé•¿ä»»åŠ¡** | âœ… å¯è®¾ç½®timeout |

### é¢„æœŸæ€§èƒ½ï¼ˆV2å®Œæ•´å®ç°åï¼‰

| æŒ‡æ ‡ | V1å½“å‰ | V2è®¾è®¡ | æå‡ |
|------|--------|--------|------|
| **ç•Œé¢å“åº”** | é•¿/çŸ­ä»»åŠ¡éƒ½é˜»å¡ | <50msï¼ˆå§‹ç»ˆï¼‰ | >1000å€ âš¡ |
| **å¹¶å‘ä»»åŠ¡** | 1ï¼ˆé˜»å¡ï¼‰ | 1000+ | 1000å€ |
| **ä»»åŠ¡è¶…æ—¶é™åˆ¶** | 10åˆ†é’Ÿ | æ— é™åˆ¶ | ç§»é™¤ |
| **ç•Œé¢å¡æ­»** | 100%ï¼ˆé•¿ä»»åŠ¡ï¼‰ | 0% | å®Œå…¨æ¶ˆé™¤ |

---

## ğŸš¨ é£é™©è¯„ä¼°

| é£é™© | çº§åˆ« | åº”å¯¹æªæ–½ |
|------|------|----------|
| **HTTP APIæ€§èƒ½ä¸è¶³** | ğŸŸ¡ ä¸­ | å·²æµ‹è¯•ï¼Œ4-6ç§’å¯æ¥å—ï¼ŒV2å¯ä¼˜åŒ–è¿æ¥æ±  |
| **å·¥å…·è°ƒç”¨ç¼ºå¤±** | ğŸŸ¢ ä½ | å·²éªŒè¯å·¥å…·è°ƒç”¨æ­£å¸¸ |
| **å¹¶å‘é™åˆ¶** | ğŸŸ¡ ä¸­ | V1å¯èƒ½æœ‰å¹¶å‘é™åˆ¶ï¼Œéœ€è¦å®é™…æµ‹è¯• |
| **è®¤è¯è¿‡æœŸ** | ğŸŸ¢ ä½ | Tokenç¨³å®šæ€§é«˜ï¼Œæ”¯æŒåˆ·æ–° |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### é˜¶æ®µ1ï¼šMVPéªŒè¯ï¼ˆ1-2å¤©ï¼‰â­

æŒ‰ç…§MEMORY.mdçš„MVPä¼˜å…ˆåŸåˆ™ï¼š

**MVPèŒƒå›´ï¼š**
- âœ… ç®€åŒ–Gatewayï¼šFastAPIï¼Œåªæ¥æ”¶æ¶ˆæ¯+è¿”å›task_id
- âœ… ç®€åŒ–Queueï¼šåªæ”¯æŒRedisé˜Ÿåˆ—ï¼ˆçŸ­ä»»åŠ¡ï¼‰
- âœ… ç®€åŒ–Workerï¼š1ä¸ªWorkerè¿›ç¨‹
- âœ… Workeræ ¸å¿ƒèƒ½åŠ›ï¼šHTTPè°ƒç”¨V1 Gateway
- âœ… ç®€åŒ–Storeï¼šRedisç¼“å­˜ç»“æœ

**éªŒè¯ç›®æ ‡ï¼š**
- [ ] Workerèƒ½å¦é€šè¿‡HTTPæˆåŠŸè°ƒç”¨V1ï¼Ÿï¼ˆâœ… å·²éªŒè¯ï¼‰
- [ ] é•¿ä»»åŠ¡æ˜¯å¦é˜»å¡V2 Gatewayç•Œé¢ï¼Ÿ
- [ ] æ˜¯å¦æ”¯æŒå–æ¶ˆ/é‡è¯•ä»»åŠ¡ï¼Ÿ
- [ ] æ€§èƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸï¼ˆ<50mså“åº”ï¼‰ï¼Ÿ

**å®æ–½æ­¥éª¤ï¼š**
1. åˆ›å»ºMVPé¡¹ç›®ç»“æ„
2. å®ç°åŸºç¡€çš„Gatewayï¼ˆFastAPIï¼‰
3. å®ç°åŸºç¡€çš„Task Queueï¼ˆRedisï¼‰
4. å®ç°åŸºç¡€çš„Worker
5. é›†æˆæµ‹è¯•

### é˜¶æ®µ2ï¼šå®Œæ•´å®æ–½ï¼ˆ2å‘¨ï¼‰

MVPéªŒè¯é€šè¿‡åï¼ŒæŒ‰ç…§åŸè®¾è®¡æ–‡æ¡£ï¼š
- [ ] å®Œæ•´Gatewayï¼ˆç†”æ–­å™¨ã€èµ„æºé™åˆ¶ï¼‰
- [ ] å®Œæ•´Queueï¼ˆä¸‰å±‚é˜Ÿåˆ—ã€ä¼˜å…ˆçº§ï¼‰
- [ ] å®Œæ•´Worker Poolï¼ˆåŠ¨æ€æ‰©ç¼©å®¹ï¼‰
- [ ] WebSocketå®æ—¶æ¨é€
- [ ] Result Storeï¼ˆSQLite + Redisï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼ˆâ‰¥80%è¦†ç›–ç‡ï¼‰
- [ ] CI/CDé…ç½®

---

## ğŸ“š ç»éªŒæ€»ç»“

### âœ… æˆåŠŸç»éªŒ

1. **å¯è¡Œæ€§è°ƒæŸ¥å¿…é¡»åš**
   - è·³è¿‡å¯è¡Œæ€§è°ƒæŸ¥ä¼šå¯¼è‡´é‡å¤§å¤±è¯¯ï¼ˆOpenClaw V2ç¬¬ä¸€æ¬¡è®¾è®¡å°±æ˜¯æ•™è®­ï¼‰
   - å…ˆè°ƒæŸ¥åå¼€å‘ï¼Œé¿å…æµªè´¹

2. **æ–‡æ¡£æ˜¯å…³é”®**
   - OpenClawçš„æ–‡æ¡£å¾ˆå®Œæ•´ï¼ŒåŒ…å«HTTP APIè¯´æ˜
   - ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œä¸è¦å‡­ç©ºçŒœæµ‹

3. **MVPéªŒè¯æœ‰ä»·å€¼**
   - å…ˆéªŒè¯æ ¸å¿ƒå‡è®¾å†æŠ•å…¥å®Œæ•´å¼€å‘
   - é¿å…å¤§è§„æ¨¡è¿”å·¥

4. **å®é™…æµ‹è¯•èƒœè¿‡ç†è®ºåˆ†æ**
   - åªæœ‰çœŸå®æµ‹è¯•æ‰èƒ½å‘ç°çœŸæ­£é—®é¢˜
   - HTTP APIçš„å®é™…æ€§èƒ½å’Œæ•°æ®æ ¼å¼éƒ½å¾ˆé‡è¦

---

## ğŸ“ å˜æ›´è®°å½•

### 2026-02-15 23:27
- âœ… å®Œæˆå¯è¡Œæ€§è°ƒæŸ¥
- âœ… éªŒè¯HTTP APIå¯ç”¨
- âœ… ç¡®è®¤V2é¡¹ç›®å¯è¡Œ
- âœ… æ˜ç¡®Workerå®ç°æ–¹å¼

---

**ç»“è®ºï¼šOpenClaw V2å¼‚æ­¥æ¶æ„é¡¹ç›®å¯è¡Œï¼Œå¯ä»¥å¼€å§‹MVPå¼€å‘ï¼** ğŸš€
